<!DOCTYPE html>
<html>
<head>
  <title>Airsoft QR Scanner</title>
  <style>
    body {
      background-color: black;
      color: red;
      font-family: monospace;
      overflow: hidden;
      text-align: center;
    }

    #confidential {
      font-size: 40px;
      margin-top: 20%;
      animation: blink 1s infinite;
    }

    #buttons {
      margin-top: 20px;
    }

    .button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      background-color: red;
      color: white;
      border: none;
      border-radius: 5px;
    }

    .button img {
      width: 20px;
      height: 15px;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes countdown {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/0.7.28/ua-parser.min.js"></script>
  <script>
    // Función para generar un UUID
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    let interval;
    const confidentialMessages = [
      "Receiving confidential data...",
      "Decrypting message...",
      "Data received successfully",
      "This message will self-destruct in"
    ];

    function getDeviceInfo() {
      const parser = new UAParser();
      const result = parser.getResult();
      return {
        device: result.device.model || "Unknown Device",
        os: result.os.name + " " + result.os.version,
        browser: result.browser.name + " " + result.browser.version
      };
    }

    function sendData(country) {
      const confidentialDiv = document.getElementById('confidential');
      const dataDiv = document.getElementById('data');
      let messageIndex = 0;

      confidentialDiv.textContent = confidentialMessages[messageIndex];
      messageIndex++;

      interval = setInterval(() => {
        if (messageIndex < confidentialMessages.length) {
          confidentialDiv.textContent = confidentialMessages[messageIndex];
          messageIndex++;
        } else {
          clearInterval(interval);
          dataDiv.style.display = 'block';
          let countdown = 5;
          dataDiv.textContent = `${countdown} seconds...`;
          let countdownInterval = setInterval(() => {
            countdown--;
            dataDiv.textContent = `${countdown} seconds...`;
            if (countdown <= 0) {
              clearInterval(countdownInterval);
              confidentialDiv.textContent = "Self-destructing...";
              confidentialDiv.style.animation = "countdown 3s forwards";
              setTimeout(() => {
                window.close();
              }, 3000);
            }
          }, 1000);
        }
      }, 2000);

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          setTimeout(() => {
            clearInterval(interval);
            confidentialDiv.textContent = "Data recorded. Thank you!";
            confidentialDiv.style.color = "lime";

            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var deviceInfo = getDeviceInfo();
            var uuid = generateUUID();
            var timestamp = new Date().toISOString();

            var scriptUrl = "https://script.google.com/macros/s/AKfycbxMqdTk4h0C-rV-6QWYiQH9kLU8FDo3TZzmF0UzMJiKYkb1Vsz6RkvqTtI58BBaFrx05w/exec";
            var url = `${scriptUrl}?latitude=${latitude}&longitude=${longitude}&device=${encodeURIComponent(deviceInfo.device)}&os=${encodeURIComponent(deviceInfo.os)}&browser=${encodeURIComponent(deviceInfo.browser)}&uuid=${uuid}&timestamp=${encodeURIComponent(timestamp)}&country=${encodeURIComponent(country)}`;

            console.log(url); // Imprimir URL para depuración

            // Redirigir a la URL del script
            window.location.href = url;
          }, 10000); // 10 segundos para permitir mostrar los mensajes
        });
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    function onButtonClick(country) {
      document.getElementById('buttons').style.display = 'none';
      sendData(country);
    }
  </script>
</head>
<body>
  <div id="confidential">Choose your side:</div>
  <div id="buttons">
    <button class="button" onclick="onButtonClick('North Korea')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/9/97/Flag_of_the_General_Staff_of_the_Korean_People%27s_Army_%28Obverse%29.svg" alt="North Korea"> North Korea
    </button>
    <button class="button" onclick="onButtonClick('South Korea')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg" alt="South Korea"> South Korea
    </button>
  </div>
  <div id="data" style="display: none;"></div>
</body>
</html>
